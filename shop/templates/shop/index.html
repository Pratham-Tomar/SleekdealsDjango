<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />

    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/css/bootstrap.min.css"
      integrity="sha384-GJzZqFGwb1QTTN6wy59ffF1BuGJpLSa9DkKMp0DgiMDm4iYMj70gZWKYbI706tWS"
      crossorigin="anonymous"
    />

    <title>Hello, world!</title>
    <style>
      @import url("https://fonts.googleapis.com/css2?family=Montserrat:wght@700&display=swap");

      .popover-content {
        background-color: #cae7f7;
        padding: 10px;
        font-family: Arial, sans-serif;
      }

      .popover-item {
        margin-bottom: 5px;
        font-size: 15px;
        font-weight: 500;
        color: #333;
      }
      .carousel-inner {
        position: relative;
      }
      .carousel-inner img {
        height: 500px;
        object-fit: cover; 
      }
      .col-md-3 {
        display: inline-block;
        margin-left: -4px;
      }
      .carousel-indicators .active {
        background-color: rgb(0, 0, 0);
      }
      .col-md-3 img {
        width: auto;
        object-fit: contain;
        height: 255px;
      }
      body .carousel-indicator li {
        background-color: rgb(46, 4, 255);
      }
      body .carousel-indicators {
        bottom: 0;
      }
      .carousel-control-prev-icon,
      .carousel-control-next-icon {
        background-color: rgb(3, 15, 248);
        width: 30px; 
        height: 30px; 
      }

      body .carousel-control-prev-icon,
      body .carousel-control-next-icon {
        background-color: rgb(3, 15, 248);
      }

      .carousel-control-prev,
      .carousel-control-next {
        top: 0;
        bottom: 0;
        width: 40px; 
        margin: auto;
        z-index: 1;
      }
      .carousel-control-prev {
        left: 0;
      }
      .popover {
        margin-top: 10%;
        margin-left: 30%;
        justify-content: center;
        justify-items: center;
      }
      .mm {
        font-family: "Montserrat", sans-serif;
        font-size: 24px;
        color: #333;
        font-weight: 600;
      }
      #carouselExampleControls {
        margin-bottom: 2%;
      }

      .carousel-control-next {
        right: 0;
      }
      body .no-padding {
        padding-left: 0;
        padding-right: 0;
      }
    </style>
  </head>
  <body>
    {% load static %} {% block body %}
    <nav
      class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top"
      id="navbar"
    >
      <a class="navbar-brand" href="/">SleekDeals</a>
      <button
        class="navbar-toggler"
        type="button"
        data-toggle="collapse"
        data-target="#navbarSupportedContent"
        aria-controls="navbarSupportedContent"
        aria-expanded="false"
        aria-label="Toggle navigation"
      >
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <ul class="navbar-nav mr-auto">
          <li class="nav-item active">
            <a class="nav-link" href="/shop"
              >Home <span class="sr-only">(current)</span></a
            >
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/shop/about">About Us</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/shop/tracker">Tracker</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/shop/contact">Contact Us</a>
          </li>
        </ul>
        <form
          method="get"
          action="/shop/search/"
          class="form-inline my-2 my-lg-0"
        >
          <input
            class="form-control mr-sm-2"
            type="search"
            placeholder="Enter Product Name"
            aria-label="Search"
            name="search"
            id="search"
          />
          <button class="btn btn-outline-success my-2 my-sm-0" type="submit">
            Search
          </button>
        </form>
        <button
          type="button"
          id="popcart"
          class="btn btn-secondary mx-2"
          data-bs-container="parent"
          data-bs-toggle="popover"
          data-bs-placement="bottom"
          data-bs-content="Bottom popover"
        >
          Cart(<span id="cart">0</span>)
        </button>
        <div id="popover-content" style="display: none"></div>
      </div>
    </nav>
    {% endblock %}
    <div
      id="carouselExampleControls"
      class="carousel slide"
      data-ride="carousel"
      data-interval="5000"
    >
      <div class="carousel-inner">
        <div class="carousel-item active">
          <img
            class="d-block w-100"
            src="https://prod-img.thesouledstore.com/public/theSoul/storage/mobile-cms-media-prod/banner-images/Plaid_Shirt_Homepage_Banner_rRaO32K.jpg?format=webp&w=1500&dpr=2.0"
            alt="First slide"
          />
        </div>
        <div class="carousel-item">
          <img
            class="d-block w-100"
            src="https://media-ik.croma.com/prod/https://media.croma.com/image/upload/v1718029491/Croma%20Assets/CMS/Homepage%20Banners/HP%20Rotating/2024/June/11062024/Desktop/HP_Rotating_WM_11june24_t610cz.jpg"
            alt="Second slide"
          />
        </div>
        <div class="carousel-item">
          <img
            class="d-block w-100"
            src="https://media-ik.croma.com/prod/https://media.croma.com/image/upload/v1718029489/Croma%20Assets/CMS/Homepage%20Banners/HP%20Rotating/2024/June/11062024/Desktop/HP_Rotating_TV_11june24_syb8ut.jpg"
            alt="Third slide"
          />
        </div>
      </div>
      <a
        class="carousel-control-prev"
        href="#carouselExampleControls"
        role="button"
        data-slide="prev"
      >
        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
        <span class="sr-only">Previous</span>
      </a>
      <a
        class="carousel-control-next"
        href="#carouselExampleControls"
        role="button"
        data-slide="next"
      >
        <span class="carousel-control-next-icon" aria-hidden="true"></span>
        <span class="sr-only">Next</span>
      </a>
    </div>

    <div class="container">
      {% for product, range, nslides in allProds %}
      <h5 class="mm">
        <a href="{% url 'subcategory' product.0.subcategory %}">
          Flash Sale On {{ product.0.subcategory }} - Recommended items
        </a>
      </h5>
      <div
        id="demo{{ forloop.counter }}"
        class="carousel slide my-3"
        data-ride="carousel"
      >
        <ul class="carousel-indicators">
          <li
            data-target="#demo{{ forloop.counter }}"
            data-slide-to="0"
            class="active"
          ></li>
          {% for i in range %}
          <li
            data-target="#demo{{ forloop.parentloop.counter }}"
            data-slide-to="{{ i }}"
          ></li>
          {% endfor %}
        </ul>

        <div class="carousel-inner no-padding">
          <div class="carousel-item active">
            {% for i in product %}
            <div class="col-xs-3 col-sm-3 col-md-3">
              <div class="card" style="width: 18rem">
                <img
                  src="/media/{{ i.image }}"
                  class="card-img-top"
                  alt="..."
                />
                <div class="card-body">
                  <h5 class="card-title" id="namepr{{ i.id }}">
                    {{ i.product_name }}
                  </h5>
                  <p class="card-text">{{ i.Description }}</p>
                  <h6 class="card-title">
                    Price: &#8377;
                    <span id="pricepr{{ i.id }}">{{ i.price }}</span>
                  </h6>
                  <div id="divpr{{ i.id }}" class="divpr">
                    <button id="minus{{ i.id }}" class="btn btn-primary minus">
                      -
                    </button>
                    <span id="valpr{{ i.id }}"
                      ><button id="pr{{ i.id }}" class="btn btn-primary cart">
                        Add to cart
                      </button></span
                    >
                    <button id="plus{{ i.id }}" class="btn btn-primary plus">
                      +
                    </button>
                  </div>
                </div>
              </div>
            </div>
            {% if forloop.counter|divisibleby:4 and not forloop.last %}
          </div>
          <div class="carousel-item">{% endif %} {% endfor %}</div>
        </div>

        <a
          class="carousel-control-prev"
          href="#demo{{ forloop.counter }}"
          role="button"
          data-slide="prev"
        >
          <span class="carousel-control-prev-icon" aria-hidden="true"></span>
          <span class="sr-only">Previous</span>
        </a>
        <a
          class="carousel-control-next"
          href="#demo{{ forloop.counter }}"
          role="button"
          data-slide="next"
        >
          <span class="carousel-control-next-icon" aria-hidden="true"></span>
          <span class="sr-only">Next</span>
        </a>
      </div>
      {% endfor %}
    </div>

    {% block js %}
    <script
      src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
      integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.6/umd/popper.min.js"
      integrity="sha384-wHAiFfRlMFy6i5SRaxvfOCifBUQy1xHdJ/yoi7FRNXMRBu5WHdZYu1hA6ZOblgut"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/js/bootstrap.min.js"
      integrity="sha384-B0UglyR+jN6CkvvICOB2joaf5I4l3gm9GU6Hc1og6Ls7i6U/mkkaduKaBhlAXv9k"
      crossorigin="anonymous"
    ></script>

    <script>
      window.onscroll = function () {
        scrollFunction();
      };

      function scrollFunction() {
        var navbar = document.getElementById("navbar");
        var cartPopover = document.getElementById("popover-content");
        var navbarHeight = navbar.offsetHeight;
        var scrollTop =
          window.pageYOffset || document.documentElement.scrollTop;

        if (scrollTop > 0) {
          navbar.style.top = "0";
          cartPopover.style.top = navbarHeight + "px";
        } else {
          navbar.style.top = "-" + navbarHeight + "px";
          cartPopover.style.top = "0";
        }
      }

      if (localStorage.getItem("cart") == null) {
        var cart = {};
      } else {
        cart = JSON.parse(localStorage.getItem("cart"));
        document.getElementById("cart").innerHTML = Object.keys(cart).length;
        updateCart(cart);
      }

      $(".divpr").on("click", "button.cart", function () {
        var idstr = this.id.toString();
        if (cart[idstr] != undefined) {
          qty = cart[idstr][0] + 1;
          cart[idstr] = [qty, name, parseInt(price)];
        } else {
          qty = 1;
          name = document.getElementById("name" + idstr).innerHTML;
          price = document.getElementById("price" + idstr).innerHTML;
          cart[idstr] = [qty, name, parseInt(price)];
        }
        updateCart(cart);
        localStorage.setItem("cart", JSON.stringify(cart));
      });

      const exampleEl = document.getElementById("popcart");
      const popover = new bootstrap.Popover(exampleEl, {
        placement: "bottom",
        title: "Cart",
        content: "Click to view your orders",
        trigger: "hover",
      });
      function updatePopover(cart) {
        console.log("we are here");
        var popContent = "<div class='popover-content'>";
        var i = 1;
        for (var item in cart) {
          var itemName = $("#name" + item).text();
          var quantity = cart[item][0] ? cart[item][0] : 0;
          popContent += "<div class='popover-item'>";
          popContent += i + ". " + itemName + " Qty: " + quantity + "\n";
          popContent += "</div>";
          i++;
        }
        popContent +=
          "</div> <a href='/shop/checkout'><button class='btn btn-primary' id ='checkout'>Checkout</button></a> <button class='btn btn-primary' onclick='clearCart()' id ='clearCart'>Clear Cart</button>     ";

        $("#popcart").popover("dispose");
        $("#popcart").popover({
          content: popContent,
          html: true,
        });
        $("#popcart").popover("show");
      }

      function clearCart() {
        localStorage.clear();
        window.location.reload();
      }
      function updateCart(cart) {
        var sum = 0;
        for (var item in cart) {
          sum = sum + cart[item][0];
          var elem = document.getElementById("valpr" + item);
          if (elem) {
            elem.innerHTML = cart[item][0];
          }
        }
        localStorage.setItem("cart", JSON.stringify(cart));
        document.getElementById("cart").innerHTML = sum;
        console.log(cart);
        updatePopover(cart);
      }

      $(".divpr").on("click", "button.minus", function () {
        let id = this.id.replace("minus", "");
        cart["pr" + id][0] = Math.max(0, cart["pr" + id][0] - 1);
        let elem = document.getElementById("valpr" + id);
        if (elem) {
          elem.innerHTML = cart["pr" + id][0];
        }
        if (cart["pr" + id][0] == 0) {
          document.getElementById("divpr" + id).innerHTML =
            '<button id="pr' +
            id +
            '" class="btn btn-primary cart">Add to Cart</button>';
          delete cart["pr" + id];
        }

        updateCart(cart);
      });
      $(".divpr").on("click", "button.plus", function () {
        var id = this.id.replace("plus", "");
        cart["pr" + id][0] = cart["pr" + id][0] + 1;
        var elem = document.getElementById("valpr" + id);
        if (elem) {
          elem.innerHTML = cart["pr" + id][0];
        }
        updateCart(cart);
      });
    </script>
    {% endblock %}
  </body>
</html>
